version: '3.8'

services:
  homelabmapper:
    image: ghcr.io/kahdeg-15520487/homelabmapper:latest
    container_name: homelabmapper
    restart: unless-stopped
    
    # Network mode: host allows scanning local network (web UI at http://localhost:5000)
    network_mode: host
    
    volumes:
      # Output directory for reports
      - ./output:/app/output
      
      # Scan history
      - ./.homelabmapper:/app/.homelabmapper
    
    environment:
      # Proxmox credentials
      - PROXMOX_TOKEN=${PROXMOX_TOKEN}
      
      # Portainer credentials
      - PORTAINER_TOKEN=${PORTAINER_TOKEN}
      
      # Docker credentials (if needed)
      - DOCKER_TOKEN=${DOCKER_TOKEN}
      
      # Unraid credentials (if needed)
      - UNRAID_API_KEY=${UNRAID_API_KEY}
      
      # Router credentials
      - ROUTER_PASSWORD=${ROUTER_PASSWORD}
      
      # SSH credentials (if needed)
      - SSH_PASSWORD=${SSH_PASSWORD}
      
      # Timezone
      - TZ=UTC
    
    # Run in server mode with web UI (access at http://localhost:5000)
    command: ["--server"]
    
    # Or run scan on a schedule (CLI mode)
    # command: sh -c "while true; do dotnet HomelabMapper.CLI.dll config.yaml && sleep 3600; done"
    
    # Health check
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:5000/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
